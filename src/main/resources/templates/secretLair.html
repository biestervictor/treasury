<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Secret Lairs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .id-column { display: none; }
        tr.clickable-row { cursor: pointer; }
    </style>
</head>
<body class="bg-light">
<nav th:replace="secretLairNavbar.html :: nav"></nav>
<div th:replace="addSecretLair.html :: addForm"></div>
<div class="mb-3">
    <button class="btn btn-secondary" onclick="toggleIdColumn()">ID-Spalte ein-/ausblenden</button>
</div>
<table class="table table-striped table-hover" id="secretLairTable">
    <thead>
    <tr>
        <th class="id-column">ID</th>
        <th>Deck</th>
        <th>Einkaufspreis</th>
        <th>Kaufdatum</th>
        <th>Name</th>
        <th>Letztes Update</th>
        <th>Aktueller Wert</th>
        <th>Lagerort</th>
        <th>URL</th>
        <th>Foil</th>
        <th>Verkauft</th>
        <th>Angebote</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="sl : ${secretlair}" class="clickable-row"
        th:attr="data-id=${sl.id},
                 data-location=${sl.location},
                 data-currentvalue=${sl.currentValue},
                 data-issold=${sl.sold},
                 data-datebought=${#temporals.format(sl.dateBought, 'yyyy-MM-dd')}">
        <td class="id-column" th:text="${sl.id}"></td>
        <td th:text="${sl.deck ? 'Ja' : 'Nein'}"></td>
        <td th:text="${sl.valueBought}"></td>
        <td th:text="${#temporals.format(sl.dateBought, 'yyyy-MM-dd')}"></td>
        <td th:text="${sl.name}"></td>
        <td th:text="${#temporals.format(sl.updatedAt, 'yyyy-MM-dd')}"></td>
        <td th:text="${sl.currentValue}" th:classappend="${sl.currentValue > sl.valueBought} ? 'text-success'"></td>
        <td th:text="${sl.location}"></td>
        <td><a th:href="${sl.url}" th:text="${sl.url}"></a></td>
        <td th:text="${sl.foil ? 'Ja' : 'Nein'}"></td>
        <td th:text="${sl.sold ? 'Ja' : 'Nein'}"></td>
        <td>
            <ul>
                <li th:each="angebot : ${sl.angebotList}" th:text="${angebot.name + ' - ' + angebot.preis + ' €'}"></li>
            </ul>
        </td>
    </tr>
    </tbody>
</table>

<!-- Modal für Bearbeitung -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <form action="/api/secretlair/update" method="post" id="editForm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Secret Lair bearbeiten</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="modalId" />
                    <div class="mb-3">
                        <label for="modalLocation" class="form-label">Lagerort</label>
                        <input type="text" class="form-control" name="location" id="modalLocation" />
                    </div>
                    <div class="mb-3">
                        <label for="modalCurrentValue" class="form-label">Aktueller Wert</label>
                        <input type="number" class="form-control" name="currentValue" id="modalCurrentValue" step="0.01" />
                    </div>
                    <div class="mb-3">
                        <label for="modalIsSold" class="form-label">Verkauft</label>
                        <input type="checkbox" name="isSold" id="modalIsSold" />
                    </div>
                    <div class="mb-3">
                        <label for="modalDateBought" class="form-label">Kaufdatum</label>
                        <input type="date" class="form-control" name="dateBought" id="modalDateBought" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Speichern</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function toggleIdColumn() {
        const idColumns = document.querySelectorAll('.id-column');
        idColumns.forEach(column => {
            column.classList.toggle('hidden');
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.clickable-row').forEach(function(row) {
            row.addEventListener('click', function() {
                document.getElementById('modalId').value = row.getAttribute('data-id');
                document.getElementById('modalLocation').value = row.getAttribute('data-location');
                document.getElementById('modalCurrentValue').value = row.getAttribute('data-currentvalue');
                document.getElementById('modalIsSold').checked = row.getAttribute('data-issold') === 'true';
                document.getElementById('modalDateBought').value = row.getAttribute('data-datebought');
                new bootstrap.Modal(document.getElementById('editModal')).show();
            });
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>